
/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                               K_LIB.c
			                              wzq
						      2013/6/5
  ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/


#include "const.h"
#include "type.h"
#include "proto.h"
#include "global.h"

#include "lib_proto.h"

/*======================================================================*
  sys_get_ticks
  *======================================================================*/
int sys_get_ticks()
{
  return sys_ticks;
}

/*======================================================================*
  num_to_str
  *======================================================================*/
void int_to_str(char * str, int num)
{
  char* p = str;
  char	ch;
  int	i;
  int   flag = FALSE;

  *p++ = '0';
  *p++ = 'x';

  if(num == 0){
    *p++ = '0';
  }
  else{
    for(i=28;i>=0;i-=4){
      ch = (num >> i) & 0xF;

      if (flag || ch>0) {
	flag = TRUE;
	ch += '0';
	if(ch > '9'){
	  ch += 7;
	}
	*p++ = ch;
      }
    }
  }

  *p = '\0';

}

/*======================================================================*
  disp_int
  *======================================================================*/
void disp_int(int input)
{
  char output[16];
  int_to_str(output, input);
  disp_str(output);
}

/*======================================================================*
  milli_delay
  *======================================================================*/
void milli_delay(int milli_sec)
{
  int t = sys_get_ticks();

  while(((sys_get_ticks() - t) * 1000 / CLOCK_FREQ) < milli_sec) {}
}

/*======================================================================*
  delay
  *======================================================================*/
void delay(int time)
{
  int i, j, k;
  for (k = 0; k < time; k++) {
    for (i = 0; i < 10; i++) {
      for (j = 0; j < 10000; j++) {}
    }
  }
}
